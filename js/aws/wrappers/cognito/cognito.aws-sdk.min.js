var AWSSDKArgs=document.getElementById("aws-cognito-services-sdk"),AWSConstants={region:AWSSDKArgs.getAttribute("data-region"),cognitoEndpoint:"cognito-idp."+AWSSDKArgs.getAttribute("data-region")+".amazonaws.com",userPoolId:AWSSDKArgs.getAttribute("data-userPoolId"),clientId:AWSSDKArgs.getAttribute("data-clientId"),identityPoolId:AWSSDKArgs.getAttribute("data-identityPoolId"),samlDomain:AWSSDKArgs.getAttribute("data-samlDomain"),samlIdentifier:AWSSDKArgs.getAttribute("data-samlIdentifier"),samlRedirect:AWSSDKArgs.getAttribute("data-samlRedirect"),samlEndpoint:"https://"+AWSSDKArgs.getAttribute("data-samlDomain")+".auth.eu-west-1.amazoncognito.com/authorize?idp_identifier="+AWSSDKArgs.getAttribute("data-samlIdentifier")+"&identity_provider="+AWSSDKArgs.getAttribute("data-samlIdentifier")+"&response_type=code&client_id="+AWSSDKArgs.getAttribute("data-clientId")+"&redirect_uri="+AWSSDKArgs.getAttribute("data-samlRedirect"),samlTokenEndpoint:"https://"+AWSSDKArgs.getAttribute("data-samlDomain")+".auth.eu-west-1.amazoncognito.com/oauth2/token",apiEndpoint:AWSSDKArgs.getAttribute("data-apiEndpoint")};AWS.config.region=AWSConstants.region,AWS.config.credentials=new AWS.CognitoIdentityCredentials({IdentityPoolId:AWSConstants.identityPoolId}),AWSCognito.config.region=AWSConstants.region,AWSCognito.config.credentials=new AWS.CognitoIdentityCredentials({IdentityPoolId:AWSConstants.identityPoolId});var userPool=new AWSCognito.CognitoIdentityServiceProvider.CognitoUserPool({UserPoolId:AWSConstants.userPoolId,ClientId:AWSConstants.clientId}),cognitoUser=null,refreshToken=Cookies.get("refreshToken"),Cognito=function(){"use strict";return{signup:function(email,password,callbackSuccess,callbackError){var attributeList=[],dataEmail={Name:"email",Value:email.toLowerCase()},attributeEmail=new AWSCognito.CognitoIdentityServiceProvider.CognitoUserAttribute(dataEmail);attributeList.push(attributeEmail),userPool.signUp(Utils.newGuid(),password,attributeList,null,(function(err,result){err?"undefined"!==callbackError&&$.isFunction(callbackError)&&callbackError(err):(cognitoUser=result.user,"undefined"!==callbackSuccess&&$.isFunction(callbackSuccess)&&callbackSuccess())}))},verify:function(code,callbackSuccess,callbackError){cognitoUser.confirmRegistration(code,!0,(function(err,result){err?"undefined"!==callbackError&&$.isFunction(callbackError)&&callbackError(err):"undefined"!==callbackSuccess&&$.isFunction(callbackSuccess)&&callbackSuccess()}))},resend:function(callbackSuccess,callbackError){cognitoUser.resendConfirmationCode((function(err,result){err?"undefined"!==callbackError&&$.isFunction(callbackError)&&callbackError(err):"undefined"!==callbackSuccess&&$.isFunction(callbackSuccess)&&callbackSuccess()}))},signin:function(email,password,callbackSuccess,callbackError){var authenticationData={Username:email.toLowerCase(),Password:password},authenticationDetails=new AWSCognito.CognitoIdentityServiceProvider.AuthenticationDetails(authenticationData),userData={Username:email.toLowerCase(),Pool:userPool};(cognitoUser=new AWSCognito.CognitoIdentityServiceProvider.CognitoUser(userData)).authenticateUser(authenticationDetails,{onSuccess:function(result){Cookies.set("accessToken",result.getAccessToken().getJwtToken(),{sameSite:"None",secure:!0}),Cookies.set("idToken",result.idToken.jwtToken,{sameSite:"None",secure:!0}),Cookies.set("refreshToken",result.refreshToken.token,{sameSite:"None",secure:!0}),refreshToken=new AWSCognito.CognitoIdentityServiceProvider.CognitoRefreshToken({RefreshToken:result.refreshToken.token,IdToken:result.idToken.jwtToken}),"undefined"!==callbackSuccess&&$.isFunction(callbackSuccess)&&callbackSuccess()},onFailure:function(err){"undefined"!==callbackError&&$.isFunction(callbackError)&&callbackError(err)}})},samlSignin:function(loginin,callback,fe){Utils.getUrlParameter("code")?(Utils.callCallback(loginin),$.ajax({method:"POST",url:AWSConstants.samlTokenEndpoint,data:"grant_type=authorization_code&client_id="+AWSConstants.clientId+"&code="+Utils.getUrlParameter("code")+"&redirect_uri="+AWSConstants.samlRedirect,headers:{"content-type":"application/x-www-form-urlencoded"},dataType:"json",success:function(response){console.log(response),Cookies.set("accessToken",response.access_token,{sameSite:"None",secure:!0}),Cookies.set("idToken",response.id_token,{sameSite:"None",secure:!0}),Cookies.set("refreshToken",response.refresh_token,{sameSite:"None",secure:!0}),console.log(Cookies.get("idToken")),window.location.href=AWSSDKArgs.getAttribute("data-home")},error:function(xhr,textStatus,errorThrown){Utils.isCallback(fe)?fe(xhr,textStatus,errorThrown):(Utils.ready(),console.log("unexpected error on AJAX call"))}})):Utils.callCallback(callback)},refreshTokens:function(callback){userPool.client.makeUnauthenticatedRequest("initiateAuth",{ClientId:AWSConstants.clientId,AuthFlow:"REFRESH_TOKEN_AUTH",AuthParameters:{REFRESH_TOKEN:refreshToken}},(function(err,authResult){if(err)console.log(err,err.stack),Cognito.logout();else{Cookies.set("accessToken",authResult.AuthenticationResult.AccessToken,{sameSite:"None",secure:!0}),Cookies.set("idToken",authResult.AuthenticationResult.IdToken,{sameSite:"None",secure:!0});var logins={};logins[AWSConstants.cognitoEndpoint+"/"+AWSConstants.userPoolId]=authResult.AuthenticationResult.IdToken,AWS.config.update({credentials:new AWS.CognitoIdentityCredentials({IdentityPoolId:AWSConstants.identityPoolId,Logins:logins})}),AWS.config.credentials.get((function(err){err&&console.log(err,err.stack)}))}})),setTimeout(Cognito.refreshTokens,3e5),void 0!==callback&&$.isFunction(callback)&&callback()},logout:function(){Cookies.set("accessToken","",{sameSite:"None",secure:!0}),Cookies.set("idToken","",{sameSite:"None",secure:!0}),Cookies.set("refreshToken","",{sameSite:"None",secure:!0}),null!==cognitoUser&&(cognitoUser.signOut(),cognitoUser=null),AWS.config.credentials.clearCachedId(),window.location.href.indexOf("127.0.0.1:")<=0?window.location.href=AWSSDKArgs.getAttribute("data-frontpage"):window.location.href="/src/UI/index.html"},initializePageAuthentication:function(callback){window.location.href.indexOf(AWSSDKArgs.getAttribute("data-frontpage"))<=0?Cookies.get("idToken")&&Cookies.get("refreshToken")?Cognito.refreshTokens(callback):Cognito.logout():void 0!==callback&&$.isFunction(callback)&&callback()}}}();