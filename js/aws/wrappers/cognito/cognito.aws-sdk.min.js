var AWSSDKArgs=document.getElementById("aws-cognito-services-sdk"),AWSConstants={region:AWSSDKArgs.getAttribute("data-region"),cognitoEndpoint:"cognito-idp."+AWSSDKArgs.getAttribute("data-region")+".amazonaws.com",userPoolId:AWSSDKArgs.getAttribute("data-userPoolId"),clientId:AWSSDKArgs.getAttribute("data-clientId"),identityPoolId:AWSSDKArgs.getAttribute("data-identityPoolId"),apiEndpoint:AWSSDKArgs.getAttribute("data-apiEndpoint")};AWS.config.region=AWSConstants.region,AWS.config.credentials=new AWS.CognitoIdentityCredentials({IdentityPoolId:AWSConstants.identityPoolId}),AWSCognito.config.region=AWSConstants.region,AWSCognito.config.credentials=new AWS.CognitoIdentityCredentials({IdentityPoolId:AWSConstants.identityPoolId});var userPool=new AWSCognito.CognitoIdentityServiceProvider.CognitoUserPool({UserPoolId:AWSConstants.userPoolId,ClientId:AWSConstants.clientId}),cognitoUser=null,token=Cookies.get("idToken"),refreshToken=Cookies.get("refreshToken"),Cognito=function(){"use strict";return{signup:function(email,password,callbackSuccess,callbackError){var attributeList=[],dataEmail={Name:"email",Value:email.toLowerCase()},attributeEmail=new AWSCognito.CognitoIdentityServiceProvider.CognitoUserAttribute(dataEmail);attributeList.push(attributeEmail),userPool.signUp(Utils.newGuid(),password,attributeList,null,function(err,result){err?"undefined"!==callbackError&&$.isFunction(callbackError)&&callbackError(err):(cognitoUser=result.user,"undefined"!==callbackSuccess&&$.isFunction(callbackSuccess)&&callbackSuccess())})},verify:function(code,callbackSuccess,callbackError){cognitoUser.confirmRegistration(code,!0,function(err,result){err?"undefined"!==callbackError&&$.isFunction(callbackError)&&callbackError(err):"undefined"!==callbackSuccess&&$.isFunction(callbackSuccess)&&callbackSuccess()})},resend:function(callbackSuccess,callbackError){cognitoUser.resendConfirmationCode(function(err,result){err?"undefined"!==callbackError&&$.isFunction(callbackError)&&callbackError(err):"undefined"!==callbackSuccess&&$.isFunction(callbackSuccess)&&callbackSuccess()})},signin:function(email,password,callbackSuccess,callbackError){var authenticationData={Username:email.toLowerCase(),Password:password},authenticationDetails=new AWSCognito.CognitoIdentityServiceProvider.AuthenticationDetails(authenticationData),userData={Username:email.toLowerCase(),Pool:userPool};(cognitoUser=new AWSCognito.CognitoIdentityServiceProvider.CognitoUser(userData)).authenticateUser(authenticationDetails,{onSuccess:function(result){Cookies.set("accessToken",result.getAccessToken().getJwtToken()),Cookies.set("idToken",result.idToken.jwtToken),Cookies.set("refreshToken",result.refreshToken.token),refreshToken=new AWSCognito.CognitoIdentityServiceProvider.CognitoRefreshToken({RefreshToken:result.refreshToken.token,IdToken:result.idToken.jwtToken}),"undefined"!==callbackSuccess&&$.isFunction(callbackSuccess)&&callbackSuccess()},onFailure:function(err){"undefined"!==callbackError&&$.isFunction(callbackError)&&callbackError(err)}})},refreshTokens:function(){userPool.client.makeUnauthenticatedRequest("initiateAuth",{ClientId:AWSConstants.clientId,AuthFlow:"REFRESH_TOKEN_AUTH",AuthParameters:{REFRESH_TOKEN:refreshToken}},function(err,authResult){if(err)Cognito.logout();else{Cookies.set("accessToken",authResult.AuthenticationResult.AccessToken),Cookies.set("idToken",authResult.AuthenticationResult.IdToken);var logins={};logins[AWSConstants.cognitoEndpoint+"/"+AWSConstants.userPoolId]=authResult.AuthenticationResult.IdToken,AWS.config.update({credentials:new AWS.CognitoIdentityCredentials({IdentityPoolId:AWSConstants.identityPoolId,Logins:logins})}),AWS.config.credentials.get(function(err){err&&console.log(err,err.stack)})}}),setTimeout(Cognito.refreshTokens,12e5)},logout:function(){Cookies.set("accessToken",""),Cookies.set("idToken",""),Cookies.set("refreshToken",""),null!==cognitoUser&&(cognitoUser.signOut(),cognitoUser=null),AWS.config.credentials.clearCachedId(),window.location.href.indexOf("127.0.0.1:")<=0?window.location.href=AWSSDKArgs.getAttribute("data-home"):window.location.href="/src/UI/index.html"},initializePageAuthentication:function(callback){if(window.location.href.indexOf(AWSSDKArgs.getAttribute("data-home"))<=0)if(token&&refreshToken){var logins={};logins[AWSConstants.cognitoEndpoint+"/"+AWSConstants.userPoolId]=token,AWS.config.credentials=new AWS.CognitoIdentityCredentials({IdentityPoolId:AWSConstants.identityPoolId,Logins:logins}),Cognito.refreshTokens(),AWS.config.credentials.get(function(err){err?console.log(err,err.stack):void 0!==callback&&$.isFunction(callback)&&callback()})}else Cognito.logout();else void 0!==callback&&$.isFunction(callback)&&callback()}}}();